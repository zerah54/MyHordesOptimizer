<mat-card-header>
    <mat-card-title>
        <ng-container i18n>Camping</ng-container>
        <button mat-icon-button (click)="shareCamping()">
            <mat-icon>share</mat-icon>
        </button>
    </mat-card-title>
</mat-card-header>
<mat-card-content class="mho-camping">
    <form [formGroup]="configuration_form" *ngIf="configuration_form">
        <div class="camping-params">
            <div>
                <ng-container *ngTemplateOutlet="citizenInfo"></ng-container>
                <ng-container *ngTemplateOutlet="cellInfo"></ng-container>
            </div>
            <ng-container *ngTemplateOutlet="townInfo"></ng-container>
        </div>
        <ng-container *ngTemplateOutlet="campingResult"></ng-container>

        <ng-template #citizenInfo>
            <div>
                <h3 i18n>Le citoyen</h3>
                <div>
                    <mat-form-field class="short-bottom">
                        <mat-label i18n>Métier</mat-label>
                        <mho-select #jobSelect [formControlName]="'job'" [options]="jobs" [bindLabel]="'value.label'">
                        </mho-select>
                    </mat-form-field>
                    <mat-checkbox [formControlName]="'vest'" *ngIf="$any(jobSelect.value)?.id === 'scout'">
                        <img [src]="HORDES_IMG_REPO +  'emotes/proscout.gif'">
                        <ng-container i18n>Tenue de camouflage</ng-container>
                    </mat-checkbox>
                    <mat-checkbox [formControlName]="'pro'">
                        <img [src]="HORDES_IMG_REPO + 'status/status_camper.gif'">
                        <ng-container i18n>Campeur professionnel</ng-container>
                    </mat-checkbox>
                    <mat-checkbox [formControlName]="'tomb'">
                        <img [src]="HORDES_IMG_REPO + 'building/small_cemetery.gif'">
                        <ng-container i18n>Tombe</ng-container>
                    </mat-checkbox>
                    <mat-form-field class="short-bottom">
                        <mat-label><img [src]="HORDES_IMG_REPO + 'emotes/sleep.gif'">
                            <ng-container i18n>Nombre de campings déjà effectués</ng-container>
                        </mat-label>
                        <input matInput type="number" [formControlName]="'campings'">
                    </mat-form-field>
                    <mat-form-field class="short-bottom">
                        <mat-label><img [src]="HORDES_IMG_REPO + 'emotes/bag.gif'">
                            <ng-container i18n>Nombre de pelures de peau et de toiles de tentes dans le sac
                            </ng-container>
                        </mat-label>
                        <input matInput type="number" [formControlName]="'objects'">
                    </mat-form-field>
                </div>
            </div>
        </ng-template>

        <ng-template #cellInfo>
            <div>
                <h3 i18n>La ville</h3>
                <div>
                    <mat-form-field class="short-bottom">
                        <mat-label i18n>Type de ville</mat-label>
                        <mho-select [formControlName]="'town'" [options]="town_types" [bindLabel]="'label'">
                        </mho-select>
                    </mat-form-field>
                    <mat-checkbox [formControlName]="'night'">
                        <img [src]="HORDES_IMG_REPO +  'pictos/r_doutsd.gif'">
                        <ng-container i18n>Nuit</ng-container>
                    </mat-checkbox>
                    <mat-checkbox [formControlName]="'devastated'">
                        <img [src]="HORDES_IMG_REPO + 'item/item_out_def_broken.gif'">
                        <ng-container i18n>Ville dévastée</ng-container>
                    </mat-checkbox>
                    <mat-checkbox [formControlName]="'phare'">
                        <img [src]="HORDES_IMG_REPO + 'building/small_lighthouse.gif'">
                        <ng-container i18n>Phare</ng-container>
                    </mat-checkbox>
                </div>
            </div>
        </ng-template>

        <ng-template #townInfo>
            <div>
                <h3 i18n>Le bâtiment</h3>
                <div>
                    <mat-form-field class="short-bottom">
                        <mat-label><img [src]="HORDES_IMG_REPO + 'emotes/explo.gif'">
                            <ng-container i18n>Distance de la ville (en km)</ng-container>
                        </mat-label>
                        <input matInput type="number" #townDistance [formControlName]="'distance'" min="1">
                    </mat-form-field>

                    <mat-form-field class="short-bottom">
                        <mat-label i18n>Bâtiment</mat-label>
                        <mho-select [formControlName]="'ruin'" [options]="ruins | filterRuinsByKm:townDistance.value"
                            [bindLabel]="'label.' + locale" [moreInfo]="getMoreRuinInfo">
                        </mho-select>
                        <mat-icon matSuffix [matTooltip]="help_ruins" style="vertical-align: middle"
                            [color]="'primary'">help_outline</mat-icon>
                    </mat-form-field>

                    <mat-form-field class="short-bottom">
                        <mat-label><img [src]="HORDES_IMG_REPO + 'emotes/zombie.gif'">
                            <ng-container i18n>Nombre de zombies sur la case</ng-container>
                        </mat-label>
                        <input matInput type="number" [formControlName]="'zombies'">
                    </mat-form-field>

                    <mat-form-field class="short-bottom">
                        <mat-label><img [src]="HORDES_IMG_REPO + 'emotes/human.gif'">
                            <ng-container i18n>Nombre de campeurs déjà cachés sur la case</ng-container>
                        </mat-label>
                        <input matInput type="number" [formControlName]="'hidden_campers'">
                    </mat-form-field>

                    <mat-divider style="margin: 0.5em 0"></mat-divider>

                    <h3>
                        <ng-container i18n>Améliorations</ng-container>
                        <mat-icon matSuffix [matTooltip]="help_amelio"
                            style="vertical-align: middle; margin-left: 0.25em;"
                            [color]="'primary'">help_outline</mat-icon>
                    </h3>
                    <mat-form-field class="short-bottom">
                        <mat-label><img [src]="HORDES_IMG_REPO + 'icons/small_refine.gif'">
                            <ng-container i18n>Nombre d'améliorations simples faites sur la case</ng-container>
                        </mat-label>
                        <input matInput type="number" [formControlName]="'improve'">
                    </mat-form-field>

                    <mat-form-field class="short-bottom">
                        <mat-label><img [src]="HORDES_IMG_REPO + 'item/cat_def.gif'">
                            <ng-container i18n>Nombre d'objets de défense installés sur la case</ng-container>
                        </mat-label>
                        <input matInput type="number" [formControlName]="'object_improve'">
                    </mat-form-field>
                    <div class="or">
                        <mat-button-toggle-group [(ngModel)]="and_amelio" [ngModelOptions]="{standalone: true}">
                            <mat-button-toggle [value]="true" i18n [checked]="and_amelio">Et</mat-button-toggle>
                            <mat-button-toggle [value]="false" i18n [checked]="!and_amelio">Ou</mat-button-toggle>
                        </mat-button-toggle-group>
                    </div>
                    <mat-form-field class="short-bottom">
                        <mat-label><img [src]="HORDES_IMG_REPO + 'icons/small_refine.gif'"> + <img
                                [src]="HORDES_IMG_REPO + 'item/cat_def.gif'">
                            <ng-container i18n>Nombre total d'améliotations sur la case</ng-container>
                        </mat-label>
                        <input matInput type="number" [formControlName]="'complete_improve'">
                    </mat-form-field>
                </div>
            </div>
        </ng-template>

        <ng-template #campingResult>
            <ng-container *ngIf="camping_result && camping_result.label && camping_result.label !== ''">
                <h3 i18n>Résultat</h3>
                <div>{{ camping_result.label }} ({{ camping_result.probability * 100 | number:'1.0-2':locale }}%)</div>
            </ng-container>
        </ng-template>

    </form>
</mat-card-content>
