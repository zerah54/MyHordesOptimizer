<td #cellHtml class="cell map-cell" [class.town]="cell.is_town" [class.visited-today]="cell.is_visited_today"
    [class.never-visited]="cell.is_never_visited"
    [ngClass]="[
        options.map_type === 'danger' ? 'danger-' + cell.danger_level : '',
        options.map_type === 'digs' ? 'dig-' + (cell|digLevel:options) : '',
        options.map_type === 'trash' ? 'trash-' + ((cell | trashValue:options:allItems)|trashLevel) : '',
        cell.zone_regen ? cell.zone_regen.value.class : ''
    ]"
    [class.alert]="options.map_type === 'danger'" [class.digs]="options.map_type === 'digs'" [class.trash]="options.map_type === 'trash'"
    [class.scrut-border-left]="cell|scrutBorderLeft:options:drawedMap"
    [class.scrut-border-top]="cell|scrutBorderTop:options:drawedMap"
    [class.scrut-border-right]="cell|scrutBorderRight:options:drawedMap"
    [class.scrut-border-bottom]="cell|scrutBorderBottom:options:drawedMap"
    (click)="openCellUpdate()" (mouseenter)="is_dev ? current_cell = cell : undefined" (mouseleave)="is_dev ? current_cell = undefined : undefined">

    <div *ngIf="cell.ruin_id" [class]="'ruin'">
        <span [class.empty-ruin]="cell.is_ruin_dryed">
            <ng-container *ngIf="cell | isRuin:allRuins">R</ng-container>
            <ng-container *ngIf="cell.nb_ruin_dig">
                <img [ngSrc]="HORDES_IMG_REPO + 'building/small_dig.gif'" width="16" height="16">
                <span class="nb-digs">{{cell.nb_ruin_dig}}</span>
            </ng-container>
        </span>
    </div>

    <div *ngIf="cell.is_town" [class]="'town-draw'">
        <img [ngSrc]="HORDES_IMG_REPO + 'icons/map/map_zone_town.svg'" width="25" height="25">
    </div>

    <div *ngIf="cell.is_dryed" [class]="'dried'">
    </div>

    <div *ngIf="cell|myCell" [class]="'my-cell'">
    </div>

    <div [class.dist-border-left]="cell|distBorderLeft:options:drawedMap"
         [class.dist-border-top]="cell|distBorderTop:options:drawedMap"
         [class.dist-border-right]="cell|distBorderRight:options:drawedMap"
         [class.dist-border-bottom]="cell|distBorderBottom:options:drawedMap"></div>

    <div class="content" *ngIf="!cell.is_town">
        <span class="corner-top-left corner">
            <img *ngIf="cell.note" [ngSrc]="HORDES_IMG_REPO + 'icons/small_talk.gif'" width="12" height="12">
        </span>
        <span class="corner-top-right corner">
            <div *ngIf="cell.citizens.length > 0">
                <img [ngSrc]="HORDES_IMG_REPO + 'log/citizen.gif'" width="12" height="12">
                <span class="detail-value">{{cell.nb_hero}}</span>
            </div>
        </span>
        <span class="corner-bottom-left corner">
            <div *ngIf="options.map_type === 'danger'">
                <img [ngSrc]="HORDES_IMG_REPO + 'icons/map/map_icon_splatter.png'" width="12" height="9">
                <span class="detail-value">{{cell.nb_zombie_killed || 0}}</span>
            </div>
        </span>
        <span class="corner-bottom-right corner">
            <div *ngIf="options.map_type === 'danger'">
                <img [ngSrc]="HORDES_IMG_REPO + 'icons/small_zombie.gif'" width="12" height="12">
                <span class="detail-value">{{cell.nb_zombie || 0}}</span>
            </div>
            <div *ngIf="options.map_type === 'digs'">
                {{((options.dig_mode === 'max' ? cell.max_potential_remaining_dig :
                cell.average_potential_remaining_dig) - cell.total_success) | number:'1.0-0':locale}}
            </div>
            <div *ngIf="options.map_type === 'trash'">
                {{cell | trashValue:options:allItems}}
            </div>
        </span>
    </div>
</td>

<mho-map-cell-details @toggleCurrentCell *ngIf="current_cell" [cell]="current_cell" [allItems]="allItems" [allRuins]="allRuins"
                      [cellHtml]="cellHtml" [allCitizens]="allCitizens">
</mho-map-cell-details>
